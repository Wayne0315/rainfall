/* 基本佈局和字體 */
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: 'Inter', Arial, sans-serif; /* 使用 Inter 字體 */
      overflow: hidden; /* 防止拖曳時出現滾動條 */
    }

    /* 頂部標頭樣式 */
    #header {
      height: 60px;
      background: #f8f8f8;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      border-bottom-left-radius: 8px; /* 圓角 */
      border-bottom-right-radius: 8px; /* 圓角 */
      flex-shrink: 0;
    }
    #header h1 {
      margin: 0;
      font-size: 24px;
      color: #333;
    }
    .organization-name {
      font-size: 14px;
      color: #666;
      white-space: nowrap;
    }

    /* 主內容區塊佈局 */
    #main-content {
      display: flex;
      flex-grow: 1; /* 讓主內容區塊佔據剩餘高度 */
      height: calc(100vh - 60px); /* 減去 header 高度 */
    }

    /* 左側 CWA 框架 */
    #cwa-frame {
      position: relative; /* 用於定位收合按鈕 */
      width: 350px; /* 初始寬度 */
      height: 100%;
      background: #f8f8f8;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      border-top-right-radius: 8px; /* 圓角 */
      border-bottom-right-radius: 8px; /* 圓角 */
      transition: width 0.3s ease-in-out; /* 寬度變化時的平滑過渡 */
      flex-shrink: 0;
    }
    #cwa-frame.collapsed {
      width: 40px; /* 收合後的寬度 */
    }
    #cwa-frame.collapsed iframe,
    #cwa-frame.collapsed .fallback {
      display: none; /* 收合時隱藏內容 */
    }
    #cwa-frame iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    #cwa-frame .fallback {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      color: #555;
    }
    #cwa-frame .fallback a {
      color: #0066cc;
      text-decoration: none;
    }
    #cwa-frame .fallback a:hover {
      text-decoration: underline;
    }

    /* 收合/展開按鈕樣式 */
    .toggle-btn {
      position: absolute;
      top: 50%;
      right: -5px; /* 按鈕稍微超出邊界，方便點擊 */
      transform: translateY(-40%);
      background-color: #848484;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 5px 10px;
      min-width: 30px;
      height: 40px;
      display: flex;
      flex-direction: column; /* 將子元素改為垂直排列 */
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      z-index: 10;
      transition: all 0.3s ease-in-out;
      font-size: 14px;
      white-space: nowrap;
    }
    .toggle-btn:hover {
      background-color: #0056b3;
      transform: translateY(-50%) scale(1.1);
    }
    .toggle-btn .arrow {
      font-size: 18px;
      margin-bottom: 2px; /* 箭頭與文字間距 */
      line-height: 1;
    }
    .toggle-btn .text {
      font-size: 12px; /* 調整文字大小 */
      line-height: 1;
    }
    
    /* ---【修改處 1】--- */
    /* 中間地圖區塊 */
    #map-container { /* 新增：地圖與圖例的容器 */
      position: relative; /* 作為圖例絕對定位的基準 */
      flex-grow: 1;
      height: 100%;
    }

    #map {
      height: 100%;
      width: 100%; /* 確保地圖填滿容器 */
      background-color: #f0f2f5; /* 給地圖一個背景色，避免載入時閃爍 */
    }
    /* ---【修改結束】--- */


    /* --- 新增：可調整大小的拉桿 --- */
    #resizer {
        width: 5px;
        background: #ccc;
        cursor: col-resize; /* 滑鼠游標變為左右箭頭 */
        height: 100%;
        flex-shrink: 0;
    }

    /* 右側排名列表 */
    #ranking {
      width: 280px; /* 初始寬度 */
      min-width: 200px; /* 最小寬度 */
      max-width: 500px; /* 最大寬度 */
      height: 100%;
      background: #f8f8f8;
      box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
      border-top-left-radius: 8px;
      border-bottom-left-radius: 8px;
      flex-shrink: 0;
    }
    #ranking-content {
        padding: 10px;
    }
    #ranking h2 {
      font-size: 18px;
      margin: 0 0 10px;
      text-align: center;
      color: #333;
    }
    #ranking #ranking-list-title {
        margin-top: 5px;
        padding-top: 5px;
        border-top: 1px solid #ddd;
    }
    #ranking ul {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
    }
    #ranking li {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      transition: background-color 0.2s;
      border-radius: 4px;
    }
    #ranking li:hover {
      background-color: #e8f4f8;
    }
    #ranking li:last-child {
      border-bottom: none;
    }
    #ranking .rank {
      font-weight: bold;
      color: #555;
    }
    #ranking .rain {
      color: #d63031;
      font-weight: bold;
    }
    #ranking .watershed {
      color: #900;
      font-weight: bold;
    }
    .clickable-watershed {
      cursor: pointer;
    }
    .clickable-watershed:hover {
      background-color: #ffebee;
    }

    /* 測站標籤樣式 (個別測站顯示時) */
    .station-label {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 3px 6px;
      font-size: 12px;
      font-weight: bold;
      color: #333;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      white-space: nowrap;
      opacity: 0.9;
    }

    /* 縣市群聚標記樣式 */

    .county-cluster-marker {
      background-color: rgba(162, 162, 162, 0.8);
      border-radius: 50%;
      color: white;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid rgb(243, 243, 243);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
    }
    .county-cluster-marker:hover {
        background-color: rgba(8, 144, 255, 0.9);
        transform: scale(1.1);
    }

    .county-cluster-marker div:first-child {
      font-size: 13px;
    }
    .county-cluster-marker div:last-child {
      font-size: 11px;
    }

    /* --- 可收合圖例樣式 --- */
    .legend {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.95);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      font-size: 12px;
      /* 修改：增加圖例寬度以容納兩欄 */
      max-width: 330px; 
      width: 100%;
      z-index: 1000;
      border: 1px solid #ddd;
    }
    .legend-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .legend-header h3 {
      font-size: 14px;
      font-weight: bold;
      color: #333;
      margin: 0;
    }
    .legend-toggle {
      font-size: 24px;
      font-weight: bold;
      line-height: 1;
      user-select: none; /* 防止點擊時選取文字 */
    }
    .legend-toggle::before {
      content: "−"; /* 預設為打開狀態的減號 */
    }
    .legend.collapsed .legend-toggle::before {
      content: "+"; /* 收合狀態的加號 */
    }
    .legend-content {
      max-height: 500px; /* 設定一個足夠大的高度 */
      overflow: hidden;
      transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, margin-top 0.3s ease-out;
      margin-top: 10px;
      border-top: 1px solid #ddd;
      padding-top: 10px;
    }
    .legend.collapsed .legend-content {
      max-height: 0;
      margin-top: 0;
      padding-top: 0;
      border-top: none;
    }

    /* 新增：讓圖例內容可以左右並排 */
    .legend-columns {
        display: flex;
        justify-content: space-between; /* 讓兩欄之間有些空間 */
        gap: 5px; /* 設定兩欄的間距 */
    }
    
    .legend-columns .legend-section {
        flex: 1; /* 讓兩欄平分寬度 */
        margin-bottom: 0; /* 取消原有的下邊距，讓版面更整齊 */
    }

    .legend-section h4 {
      margin: 0 0 8px 0;
      font-size: 12px;
      font-weight: bold;
      color: #555;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 3px;
    }
    .legend-item:last-child {
      margin-bottom: 0;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 1px solid #333;
      margin-right: 8px;
      flex-shrink: 0;
    }
    .legend-color.watershed {
      border-radius: 3px;
      border: 1px solid #666;
    }
    .legend-text {
      font-size: 11px;
      color: #333;
      line-height: 1.2;
    }


    /* 響應式調整 */
    @media (max-width: 768px) {

      /* --- RWD 模式下，調整區塊顯示順序 --- */
      #map-container { /* 修改：排序套用至容器 */
        order: 1; /* 1. 地圖 */
      }
      #ranking {
        order: 2; /* 2. 排名 */
      }
      #cwa-frame {
        order: 3; /* 3. CWA 資訊 */
      }
      /* 允許頁面在手機上滾動，並加上一個淺灰色底，讓卡片效果更明顯 */
      body {
        overflow: auto;
        background-color: #f0f2f5; 
      }

      #header {
        /* 將高度從固定改為自動，允許它隨內容擴展 */
        height: auto;
        min-height: 60px;
        
        /* 讓標題和機構名稱可以垂直排列 */
        flex-direction: column; 
        justify-content: center; /* 垂直置中 */
        padding: 10px 15px; /* 增加一點上下內距，並縮小左右內距 */
        text-align: center; /* 文字置中 */
      }

      #header h1 {
          font-size:24px; /* 縮小標題字體大小以適應小螢幕 */
          margin-bottom: 4px; /* 和下方的機構名稱間隔開 */
          line-height: 1.3; /* 增加行高，避免文字太擠 */
      }

      #header .organization-name {
          font-size: 14px; /* 也可以稍微縮小機構名稱 */

      }
      
      #main-content {
        flex-direction: column;
        height: auto; /* 讓內容決定整體高度 */
        padding-top: 15px; /* 讓第一個區塊和頂部也有些間距 */
      }

      /* ---【修改處 2】--- */
      /* 為所有區塊設定統一的外觀和間距 */
      #cwa-frame, #map-container, #ranking { /* 將 #map 改為 #map-container */
        width: 90% !important; /* 寬度設為90%，並用!important覆蓋JS的行內樣式 */
        max-width: 680px; /* 在較大的平板上，避免區塊過寬 */
        margin: 0 auto 15px auto; /* 上下邊距15px，左右自動 (實現水平置中) */
        
        border-radius: 8px; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        
        flex-shrink: 0;
        max-width: none;
      }

      /* 針對不同區塊設定各自的高度 */
      #cwa-frame {
        height:500px;
      }
      #ranking{
        height:auto;
      }
      #map-container { /* 新增：手機版容器高度自動 */
        height: auto;
      }
      #map { /* 新增：手機版地圖高度 */
        height: 550px;
      }

      /* 最後一個區塊下方也保留一些空間，讓頁面底部不擁擠 */
      #ranking {
        margin-bottom: 15px;
      }
      
      #resizer {
          display: none; /* 手機版隱藏拉桿 */
      }

      .legend {
        position: static; /* 這條規則現在可以正常運作了 */
        margin: 10px auto;
        width: calc(100% - 40px);
        max-width: none;
        box-shadow: none;
        border-radius: 8px;
        border: 1px solid #ddd;
      }
      /* ---【修改結束】--- */
    }
